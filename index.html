<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jireh Beauty Salon Nails Bar - Facturación</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #fff0f5; font-family: 'Segoe UI', sans-serif; }
    .container { max-width: 900px; margin-top: 40px; }
    .invoice { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .logo { max-width: 150px; margin-bottom: 15px; }
    .btn-pdf { margin-top: 20px; }
  </style>
</head>
<body>
<div class="container">
  <div class="invoice" id="factura">
    <div class="text-center mb-4">
      <img src="logo.png" class="logo" />
      <h2>Jireh Beauty Salon Nails Bar</h2>
      <small>Factura electrónica</small>
    </div>
    <div class="row mb-3">
      <div class="col">
        <label>Nombre del Cliente</label>
        <input type="text" id="cliente" class="form-control">
      </div>
      <div class="col">
        <label>Fecha</label>
        <input type="date" id="fecha" class="form-control">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col">
        <label>Producto o Servicio</label>
        <input type="text" id="servicio" class="form-control">
      </div>
      <div class="col">
        <label>Precio (RD$)</label>
        <input type="number" id="precio" class="form-control">
      </div>
      <div class="col">
        <label>&nbsp;</label>
        <button class="btn btn-primary w-100" onclick="agregarServicio()">Agregar</button>
      </div>
    </div>
    <table class="table table-striped">
      <thead>
        <tr><th>Servicio</th><th>Precio</th></tr>
      </thead>
      <tbody id="lista-servicios"></tbody>
      <tfoot>
        <tr><th>Total</th><th id="total">RD$ 0.00</th></tr>
      </tfoot>
    </table>
  </div>
  <button class="btn btn-success w-100 btn-pdf" onclick="generarFactura()">Guardar / Imprimir Factura</button>
</div>

<!-- Scripts necesarios -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let servicios = [];

function agregarServicio() {
  const nombre = document.getElementById('servicio').value.trim();
  const precio = parseFloat(document.getElementById('precio').value);

  if (nombre && !isNaN(precio)) {
    servicios.push({ nombre, precio });
    actualizarTabla();
    document.getElementById('servicio').value = '';
    document.getElementById('precio').value = '';
  }
}

function actualizarTabla() {
  const tbody = document.getElementById('lista-servicios');
  tbody.innerHTML = '';
  let total = 0;

  servicios.forEach(s => {
    total += s.precio;
    const row = `<tr><td>${s.nombre}</td><td>RD$ ${s.precio.toFixed(2)}</td></tr>`;
    tbody.innerHTML += row;
  });

  document.getElementById('total').textContent = `RD$ ${total.toFixed(2)}`;
}

async function generarFactura() {
  const cliente = document.getElementById('cliente').value.trim();
  const fecha = document.getElementById('fecha').value;

  if (!cliente || servicios.length === 0) {
    alert("Por favor, completa el nombre del cliente y agrega al menos un servicio.");
    return;
  }

  const { jsPDF } = window.jspdf;
  const factura = document.getElementById('factura');

  html2canvas(factura).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
    pdf.save(`Factura_${cliente}.pdf`);
  });
}
</script>
</body>
</html>
